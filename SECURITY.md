# セキュリティポリシー

Household Appのセキュリティに関する情報です。

## サポートされているバージョン

現在、以下のバージョンがセキュリティアップデートの対象です：

| バージョン | サポート状況 |
|----------|------------|
| 1.0.x    | ✅ サポート中 |

## 既知のセキュリティ制限事項

### 1. HTTPS未対応

**現状**: 現在、HTTPのみで動作します（HTTPS未対応）

**影響**: 
- 通信が暗号化されていないため、同一ネットワーク内でパケットキャプチャにより通信内容が傍受される可能性があります
- APIキーが平文で送信されます

**推奨事項**:
- 個人利用・ローカルネットワーク内での使用に限定してください
- 外部公開や商用利用には、HTTPSの導入を強く推奨します

### 2. APIキー認証のみ

**現状**: APIキー認証のみでアクセス制御を行っています

**影響**:
- APIキーが漏洩した場合、不正アクセスのリスクがあります
- レート制限が実装されていないため、DoS攻撃のリスクがあります

**推奨事項**:
- APIキーを定期的に変更することを推奨します
- 強力なAPIキーを使用してください（デフォルトのキーは変更してください）

### 3. 同一ネットワーク内でのアクセス

**現状**: 同一ネットワーク内のデバイスからアクセス可能です

**影響**:
- 同一ネットワーク内の他のデバイスからアクセスされる可能性があります

**推奨事項**:
- 信頼できるネットワークでのみ使用してください
- ファイアウォールでポート8000へのアクセスを制限することを推奨します

### 4. データベースの認証

**現状**: データベースの認証情報が固定（デフォルト: `household/household`）

**影響**:
- Dockerコンテナ内で実行されているため、直接アクセスは困難ですが、コンテナが侵害された場合のリスクがあります

**推奨事項**:
- 本番環境では、強力なパスワードに変更してください
- データベースへの直接アクセスを制限してください

## セキュリティベストプラクティス

### 1. APIキーの管理

- **デフォルトキーの変更**: `docker-compose.yml`の`API_KEY`環境変数を変更してください
- **強力なキーの使用**: ランダムで長い文字列を使用してください（推奨: 32文字以上）
- **定期的な変更**: 定期的にAPIキーを変更することを推奨します

```yaml
environment:
  API_KEY: "your-strong-random-api-key-here-minimum-32-characters"
```

### 2. ネットワークセキュリティ

- **ファイアウォール設定**: ポート8000へのアクセスを信頼できるデバイスのみに制限
- **VPNの使用**: 外部からアクセスする場合は、VPNを使用してください
- **HTTPSの導入**: 外部公開時は、リバースプロキシ（nginx等）を使用してHTTPSを導入してください

### 3. データベースの保護

- **強力なパスワード**: データベースのパスワードを変更してください
- **バックアップの暗号化**: バックアップファイルを暗号化して保存してください
- **定期的なバックアップ**: データ損失に備えて、定期的にバックアップを取得してください

### 4. 環境変数の管理

- **機密情報の保護**: 環境変数に機密情報を含めないでください（必要に応じて`.env`ファイルを使用）
- **バージョン管理**: `docker-compose.yml`に機密情報を直接記述しないでください

### 5. 定期的な更新

- **依存パッケージの更新**: セキュリティパッチがリリースされたら、依存パッケージを更新してください
- **Dockerイメージの更新**: 定期的にDockerイメージを更新してください

## 脆弱性の報告

セキュリティ上の問題を発見した場合は、以下の方法で報告してください：

### 報告方法

1. **GitHub Issues**: セキュリティ関連のIssueを作成してください（公開リポジトリの場合）
2. **直接連絡**: 個人利用の場合は、開発者に直接連絡してください

### 報告に含める情報

- 脆弱性の種類と影響範囲
- 再現手順（可能な場合）
- 影響を受けるバージョン
- 推奨される修正方法（可能な場合）

### 対応方針

- 報告を受けた脆弱性は、優先的に調査・修正します
- 修正が完了次第、CHANGELOG.mdに記載します
- 重大な脆弱性の場合は、セキュリティアドバイザリを公開します

## セキュリティチェックリスト

### 初回セットアップ時

- [ ] デフォルトのAPIキーを変更
- [ ] データベースのパスワードを変更
- [ ] ファイアウォールでポート8000へのアクセスを制限
- [ ] `HOST_IP`環境変数を正しく設定
- [ ] `CORS_ORIGINS`環境変数を適切に設定

### 定期的な確認

- [ ] APIキーが漏洩していないか確認
- [ ] データベースのバックアップを取得
- [ ] 依存パッケージのセキュリティパッチを確認
- [ ] ログに異常なアクセスがないか確認
- [ ] データベースのサイズとパフォーマンスを確認

### 本番環境へのデプロイ時

- [ ] HTTPSを導入（リバースプロキシを使用）
- [ ] 強力なAPIキーを設定
- [ ] データベースのパスワードを変更
- [ ] ファイアウォールを適切に設定
- [ ] 定期的なバックアップを設定
- [ ] ログの監視を設定

## 既知のセキュリティ機能

### 実装済み

- ✅ APIキー認証（`X-API-Key`ヘッダー）
- ✅ CORS設定（許可オリジンの制限）
- ✅ リクエスト件数制限（同期リクエスト: 最大1000件）
- ✅ データバリデーション（Pydanticスキーマ）
- ✅ 論理削除（誤削除からの復元可能）

### 未実装（将来の拡張）

- ⏳ HTTPS対応
- ⏳ レート制限
- ⏳ JWT認証
- ⏳ ユーザー管理機能
- ⏳ アクセスログの記録
- ⏳ セッション管理

## 参考資料

- **[アーキテクチャ](docs/architecture.md)**: セキュリティ考慮事項の詳細
- **[トラブルシューティング](docs/TROUBLESHOOTING.md)**: セキュリティ関連の問題の解決方法
- **[運用・保守ガイド](docs/OPERATIONS.md)**: セキュリティ関連の運用方法

## 免責事項

本アプリは個人利用を想定しており、セキュリティ対策は基本的なものに限定されています。外部公開や商用利用には、追加のセキュリティ対策（HTTPS、より強固な認証、監査ログなど）が必要です。

開発者は、本アプリの使用により生じた損害について一切の責任を負いません。

